<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tic Tac Toe</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #333);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #fff;
    }

    .container {
      text-align: center;
      max-width: 420px;
      width: 95%;
    }

    h1 {
      margin-bottom: 12px;
      font-size: 2.2rem;
      color: #eee;
      text-shadow: 0 0 15px rgba(255,255,255,0.6);
    }

    .status {
      font-size: 1.2rem;
      margin: 10px 0 20px;
      color: #ffcc00;
      min-height: 28px;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 15px auto;
    }

    .cell {
      width: 110px;
      height: 110px;
      background: #222;
      border-radius: 14px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 12px rgba(255,255,255,0.15);
      user-select: none;
      transform: scale(0.95);
    }

    .cell:hover {
      background: #444;
      transform: scale(1);
    }

    .cell.taken {
      cursor: not-allowed;
      color: #fff;
      animation: popIn 0.3s ease;
    }

    @keyframes popIn {
      0% { transform: scale(0.6); opacity: 0.2; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Winning animation highlight */
    .winning-cell {
      animation: winnerGlow 1s infinite alternate;
    }
    @keyframes winnerGlow {
      from { background: #888; color: #000; box-shadow: 0 0 12px #aaa; }
      to   { background: #bbb; color: #000; box-shadow: 0 0 22px #ddd; }
    }

    /* Scoreboard */
    .scoreboard {
      margin: 15px 0;
      display: flex;
      justify-content: space-around;
      background: #111;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(255,255,255,0.1);
    }
    .score {
      font-size: 1rem;
      font-weight: bold;
    }
    .score span {
      display: block;
      font-size: 1.4rem;
      color: #00ff88;
      margin-top: 4px;
    }

    button {
      margin: 8px;
      padding: 10px 20px;
      border: none;
      background: #00ff88;
      color: #000;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.25s;
    }
    button:hover {
      background: #00cc66;
      transform: scale(1.05);
    }

    .hidden { display: none; }

    /* === POPUP ANIMATION === */
    .popup-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .popup-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .popup {
      background: #111;
      padding: 30px 40px;
      border-radius: 15px;
      text-align: center;
      transform: scale(0.7);
      animation: popupIn 0.4s forwards;
      box-shadow: 0 0 25px rgba(255,255,255,0.3);
    }

    @keyframes popupIn {
      to { transform: scale(1); }
    }

    .popup h2 {
      font-size: 2rem;
      margin-bottom: 20px;
      color: #00ff88;
    }

    .popup button {
      background: #00ff88;
      color: #000;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tic Tac Toe</h1>

    <!-- Mode Selection -->
    <div id="modeSelect">
      <h3>Choose Mode</h3>
      <button onclick="setMode('pvp')">2 Player</button>
      <button onclick="setMode('ai')">Play vs AI</button>
    </div>

    <!-- Difficulty Selection -->
    <div id="difficultySelect" class="hidden">
      <h3>Select Difficulty</h3>
      <button onclick="setDifficulty('easy')">Easy</button>
      <button onclick="setDifficulty('medium')">Medium</button>
      <button onclick="setDifficulty('hard')">Hard</button>
    </div>

    <!-- Game -->
    <div id="game" class="hidden">
      <div class="status" id="statusText"></div>

      <!-- Scoreboard -->
      <div class="scoreboard">
        <div class="score">X Wins <span id="xScore">0</span></div>
        <div class="score">O Wins <span id="oScore">0</span></div>
        <div class="score">Draws <span id="drawScore">0</span></div>
      </div>

      <div class="board" id="board"></div>
      <button onclick="restartGame()">Restart</button>
      <button onclick="newGame()">New Game</button>
    </div>
  </div>

  <!-- Popup -->
  <div id="popupOverlay" class="popup-overlay">
    <div class="popup">
      <h2 id="popupMessage"></h2>
      <button onclick="closePopup()">OK</button>
    </div>
  </div>

  <script>
    const boardElement = document.getElementById("board");
    const statusText = document.getElementById("statusText");
    const xScoreEl = document.getElementById("xScore");
    const oScoreEl = document.getElementById("oScore");
    const drawScoreEl = document.getElementById("drawScore");

    const popupOverlay = document.getElementById("popupOverlay");
    const popupMessage = document.getElementById("popupMessage");

    let board = Array(9).fill(null);
    let currentPlayer = "X";
    let gameOver = false;
    let mode = null;          
    let difficulty = null;    
    let scores = { X: 0, O: 0, Draw: 0 };

    // --- Mode Selection ---
    function setMode(selected) {
      mode = selected;
      document.getElementById("modeSelect").classList.add("hidden");
      if (mode === "ai") {
        document.getElementById("difficultySelect").classList.remove("hidden");
      } else {
        startGame();
      }
    }

    function setDifficulty(level) {
      difficulty = level;
      document.getElementById("difficultySelect").classList.add("hidden");
      startGame();
    }

    function startGame() {
      document.getElementById("game").classList.remove("hidden");
      restartGame();
    }

    // --- Game Board ---
    function createBoard() {
      boardElement.innerHTML = "";
      board.forEach((cell, index) => {
        const cellElement = document.createElement("div");
        cellElement.classList.add("cell");
        cellElement.dataset.index = index;
        cellElement.textContent = cell;
        cellElement.addEventListener("click", handleCellClick);
        boardElement.appendChild(cellElement);
      });
      updateStatus();
    }

    function handleCellClick(e) {
      const index = e.target.dataset.index;
      if (!board[index] && !gameOver) {
        makeMove(index, currentPlayer);
        if (mode === "ai" && !gameOver && currentPlayer === "O") {
          setTimeout(aiMove, 500); 
        }
      }
    }

    function makeMove(index, player) {
      board[index] = player;
      const cell = boardElement.children[index];
      cell.textContent = player;
      cell.classList.add("taken");

      const winCombo = checkWinner();
      if (winCombo) {
        highlightWinner(winCombo);
        showPopup(player + " Wins! ðŸŽ‰");
        scores[player]++;
        updateScoreboard();
        gameOver = true;
        statusText.textContent = "";
      } else if (board.every(cell => cell)) {
        showPopup("It's a Draw! ðŸ¤");
        scores.Draw++;
        updateScoreboard();
        gameOver = true;
        statusText.textContent = "";
      } else {
        currentPlayer = player === "X" ? "O" : "X";
        updateStatus();
      }
    }

    function checkWinner() {
      const winningCombos = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (let combo of winningCombos) {
        const [a,b,c] = combo;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return combo;
        }
      }
      return null;
    }

    function highlightWinner(combo) {
      combo.forEach(i => {
        boardElement.children[i].classList.add("winning-cell");
      });
    }

    function updateStatus() {
      statusText.textContent = !gameOver ? currentPlayer + "'s Turn" : "";
    }

    // --- AI Logic ---
    function aiMove() {
      if (gameOver) return;
      let move;
      if (difficulty === "easy") {
        move = randomMove();
      } else if (difficulty === "medium") {
        move = smartMove();
      } else {
        move = bestMove(); 
      }
      makeMove(move, "O");
    }

    function randomMove() {
      let available = board.map((v,i) => v ? null : i).filter(v => v !== null);
      return available[Math.floor(Math.random() * available.length)];
    }

    function smartMove() {
      for (let i = 0; i < 9; i++) {
        if (!board[i]) {
          board[i] = "O";
          if (checkWinner()) { board[i] = null; return i; }
          board[i] = null;
        }
      }
      for (let i = 0; i < 9; i++) {
        if (!board[i]) {
          board[i] = "X";
          if (checkWinner()) { board[i] = null; return i; }
          board[i] = null;
        }
      }
      return randomMove();
    }

    function bestMove() {
      let bestScore = -Infinity;
      let move;
      for (let i = 0; i < 9; i++) {
        if (!board[i]) {
          board[i] = "O";
          let score = minimax(board, 0, false);
          board[i] = null;
          if (score > bestScore) {
            bestScore = score;
            move = i;
          }
        }
      }
      return move;
    }

    function minimax(state, depth, isMaximizing) {
      let result = checkWinner();
      if (result) {
        return state[result[0]] === "O" ? 10 - depth : -10 + depth;
      }
      if (state.every(cell => cell)) return 0;

      if (isMaximizing) {
        let bestScore = -Infinity;
        for (let i = 0; i < 9; i++) {
          if (!state[i]) {
            state[i] = "O";
            let score = minimax(state, depth+1, false);
            state[i] = null;
            bestScore = Math.max(score, bestScore);
          }
        }
        return bestScore;
      } else {
        let bestScore = Infinity;
        for (let i = 0; i < 9; i++) {
          if (!state[i]) {
            state[i] = "X";
            let score = minimax(state, depth+1, true);
            state[i] = null;
            bestScore = Math.min(score, bestScore);
          }
        }
        return bestScore;
      }
    }

    // --- Popup ---
    function showPopup(message) {
      popupMessage.textContent = message;
      popupOverlay.classList.add("active");
    }

    function closePopup() {
      popupOverlay.classList.remove("active");
    }

    // --- Scoreboard ---
    function updateScoreboard() {
      xScoreEl.textContent = scores.X;
      oScoreEl.textContent = scores.O;
      drawScoreEl.textContent = scores.Draw;
    }

    // --- Game Controls ---
    function restartGame() {
      board = Array(9).fill(null);
      currentPlayer = "X";
      gameOver = false;
      createBoard();
      closePopup();
    }

    function newGame() {
      restartGame();
      scores = { X: 0, O: 0, Draw: 0 };
      updateScoreboard();
      mode = null;
      difficulty = null;
      statusText.textContent = "";
      document.getElementById("game").classList.add("hidden");
      document.getElementById("modeSelect").classList.remove("hidden");
      document.getElementById("difficultySelect").classList.add("hidden");
    }

    createBoard();
  </script>
</body>
</html>
